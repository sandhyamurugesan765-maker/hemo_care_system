{% extends "base.html" %}

{% block title %}Edit Donor{% endblock %}

{% block content %}
<div class="form-container">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <h1>Edit Donor Details</h1>
        <a href="{{ url_for('history', donor_id=donor.donor_id) }}" style="background: #6c757d; color: white; padding: 8px 15px; border-radius: 5px; text-decoration: none; display: inline-flex; align-items: center; gap: 5px;">
            <i class="fas fa-arrow-left"></i> Back to History
        </a>
    </div>
    
    <form method="POST" action="{{ url_for('edit_donor', donor_id=donor.donor_id) }}">
        <div class="form-section">
            <h3>Personal Information</h3>
            <div class="form-row">
                <div class="form-group">
                    <label>Full Name *</label>
                    <input type="text" name="name" class="form-control" value="{{ donor.name }}" required>
                </div>
                
                <div class="form-group">
                    <label>Date of Birth *</label>
                    <input type="date" name="dob" class="form-control" value="{{ donor.date_of_birth }}" required onchange="calculateAge(this.value)">
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label>Gender *</label>
                    <select name="gender" class="form-control" required>
                        <option value="Male" {% if donor.gender == 'Male' %}selected{% endif %}>Male</option>
                        <option value="Female" {% if donor.gender == 'Female' %}selected{% endif %}>Female</option>
                        <option value="Other" {% if donor.gender == 'Other' %}selected{% endif %}>Other</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Blood Group *</label>
                    <select name="blood_group" class="form-control" required>
                        <option value="A+" {% if donor.blood_group == 'A+' %}selected{% endif %}>A+</option>
                        <option value="A-" {% if donor.blood_group == 'A-' %}selected{% endif %}>A-</option>
                        <option value="B+" {% if donor.blood_group == 'B+' %}selected{% endif %}>B+</option>
                        <option value="B-" {% if donor.blood_group == 'B-' %}selected{% endif %}>B-</option>
                        <option value="O+" {% if donor.blood_group == 'O+' %}selected{% endif %}>O+</option>
                        <option value="O-" {% if donor.blood_group == 'O-' %}selected{% endif %}>O-</option>
                        <option value="AB+" {% if donor.blood_group == 'AB+' %}selected{% endif %}>AB+</option>
                        <option value="AB-" {% if donor.blood_group == 'AB-' %}selected{% endif %}>AB-</option>
                    </select>
                </div>
            </div>
        </div>
        
        <div class="form-section">
            <h3>Contact Information</h3>
            <div class="form-row">
                <div class="form-group">
                    <label>City *</label>
                    <input type="text" name="city" class="form-control" value="{{ donor.city }}" required>
                </div>
                
                <div class="form-group">
                    <label>Phone Number *</label>
                    <input type="tel" name="phone" class="form-control" value="{{ donor.phone }}" required pattern="[0-9]{10}">
                </div>
            </div>
            
            <div class="form-group">
                <label>Email Address</label>
                <input type="email" name="email" class="form-control" value="{{ donor.email or '' }}">
            </div>
        </div>
        
        <div class="form-section">
            <h3>Medical Information</h3>
            <div class="form-group">
                <label>Medical Details</label>
                <textarea name="medical_details" class="form-control" rows="3">{{ donor.medical_details or '' }}</textarea>
            </div>
            
            <div class="form-group">
                <label>
                    <input type="checkbox" name="eligible" value="1" {% if donor.eligible %}checked{% endif %}>
                    Eligible to donate
                </label>
            </div>
        </div>
        
        <div class="form-actions">
            <button type="submit" class="btn btn-primary">
                <i class="fas fa-save"></i> Update Donor
            </button>
            <a href="{{ url_for('donor_detail', donor_id=donor.donor_id) }}" class="btn">
                <i class="fas fa-times"></i> Cancel
            </a>
        </div>
    </form>
</div>

<script>
function calculateAge(dob) {
    if (!dob) return;
    const birthDate = new Date(dob);
    const today = new Date();
    let age = today.getFullYear() - birthDate.getFullYear();
    const monthDiff = today.getMonth() - birthDate.getMonth();
    if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
        age--;
    }
    
    // Show age
    const ageDisplay = document.createElement('div');
    ageDisplay.style.marginTop = '5px';
    ageDisplay.style.padding = '5px';
    ageDisplay.style.borderRadius = '4px';
    ageDisplay.style.background = age >= 18 && age <= 65 ? '#d4edda' : '#f8d7da';
    ageDisplay.style.color = age >= 18 && age <= 65 ? '#155724' : '#721c24';
    ageDisplay.innerHTML = `Age: ${age} years - ${age >= 18 && age <= 65 ? 'Eligible' : 'Not Eligible'}`;
    
    const existing = document.querySelector('.age-display');
    if (existing) existing.remove();
    
    ageDisplay.className = 'age-display';
    document.querySelector('input[name="dob"]').parentElement.appendChild(ageDisplay);
}
</script>
{% endblock %}